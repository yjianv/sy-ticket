<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
    <title layout:title-pattern="$CONTENT_TITLE - $LAYOUT_TITLE" th:text="${module.name}">模块详情</title>
</head>

<body>
    <div layout:fragment="content">
        <!-- 页面标题 -->
        <div class="page-header">
            <div class="page-header-content">
                <div class="page-header-left">
                    <h1 class="page-header-title" th:text="${module.name}">模块名称</h1>
                    <p class="page-header-subtitle">模块详细信息</p>
                </div>
                <div class="page-header-right">
                    <a th:href="@{/modules/{id}/edit(id=${module.id})}" class="btn btn-primary">
                        <i class="fas fa-edit"></i>编辑模块
                    </a>
                    <a href="/modules" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i>返回列表
                    </a>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3" style="gap: var(--space-6);">
            <!-- 模块信息 -->
            <div class="lg:col-span-2">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">基本信息</h3>
                    </div>
                    <div class="card-body">
                        <div class="grid grid-cols-1 md:grid-cols-2" style="gap: var(--space-6);">
                            <div>
                                <label style="display: block; font-size: var(--text-sm); font-weight: var(--font-medium); color: var(--color-text-secondary); margin-bottom: var(--space-2);">模块名称</label>
                                <div style="font-size: var(--text-base); font-weight: var(--font-medium); color: var(--color-text-primary);" th:text="${module.name}">模块名称</div>
                            </div>
                            
                            <div>
                                <label style="display: block; font-size: var(--text-sm); font-weight: var(--font-medium); color: var(--color-text-secondary); margin-bottom: var(--space-2);">状态</label>
                                <div>
                                    <span th:if="${module.enabled}" 
                                          class="badge workspace-badge"
                                          style="background-color: var(--color-success-600);">启用</span>
                                    <span th:unless="${module.enabled}" 
                                          class="badge workspace-badge"
                                          style="background-color: var(--color-gray-500);">禁用</span>
                                </div>
                            </div>
                            
                            <div>
                                <label style="display: block; font-size: var(--text-sm); font-weight: var(--font-medium); color: var(--color-text-secondary); margin-bottom: var(--space-2);">负责人</label>
                                <div style="font-size: var(--text-base); color: var(--color-text-primary);">
                                    <span th:if="${module.owner != null}" 
                                          th:text="${module.owner.realName ?: module.owner.username}">负责人</span>
                                    <span th:unless="${module.owner != null}" 
                                          style="color: var(--color-text-secondary);">未设置</span>
                                </div>
                            </div>
                            
                            <div>
                                <label style="display: block; font-size: var(--text-sm); font-weight: var(--font-medium); color: var(--color-text-secondary); margin-bottom: var(--space-2);">排序</label>
                                <div style="font-size: var(--text-base); color: var(--color-text-primary);" th:text="${module.sortOrder ?: 0}">0</div>
                            </div>
                            
                            <div>
                                <label style="display: block; font-size: var(--text-sm); font-weight: var(--font-medium); color: var(--color-text-secondary); margin-bottom: var(--space-2);">创建时间</label>
                                <div style="font-size: var(--text-base); color: var(--color-text-primary);" th:text="${#temporals.format(module.createdAt, 'yyyy-MM-dd HH:mm:ss')}">创建时间</div>
                            </div>
                            
                            <div>
                                <label style="display: block; font-size: var(--text-sm); font-weight: var(--font-medium); color: var(--color-text-secondary); margin-bottom: var(--space-2);">更新时间</label>
                                <div style="font-size: var(--text-base); color: var(--color-text-primary);" th:text="${#temporals.format(module.updatedAt, 'yyyy-MM-dd HH:mm:ss')}">更新时间</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: var(--space-6); padding-top: var(--space-6); border-top: 1px solid var(--color-border);">
                            <label style="display: block; font-size: var(--text-sm); font-weight: var(--font-medium); color: var(--color-text-secondary); margin-bottom: var(--space-2);">模块描述</label>
                            <div style="font-size: var(--text-base); color: var(--color-text-primary); line-height: var(--leading-relaxed);">
                                <span th:if="${module.description != null and !module.description.empty}" 
                                      th:text="${module.description}">模块描述</span>
                                <span th:unless="${module.description != null and !module.description.empty}" 
                                      style="color: var(--color-text-secondary); font-style: italic;">暂无描述</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 操作面板 -->
            <div>
                <div class="card" style="margin-bottom: var(--space-6);">
                    <div class="card-header">
                        <h3 class="card-title">操作</h3>
                    </div>
                    <div class="card-body">
                        <div style="display: flex; flex-direction: column; gap: var(--space-3);">
                            <a th:href="@{/modules/{id}/edit(id=${module.id})}" 
                               class="btn btn-primary" style="width: 100%;">
                                <i class="fas fa-edit"></i>编辑模块
                            </a>
                            
                            <button th:if="${module.enabled}" 
                                    type="button" 
                                    class="btn btn-warning" 
                                    style="width: 100%;"
                                    onclick="disableModule()"
                                    th:data-id="${module.id}"
                                    th:data-name="${module.name}">
                                <i class="fas fa-ban"></i>禁用模块
                            </button>
                            
                            <button th:unless="${module.enabled}" 
                                    type="button" 
                                    class="btn btn-success" 
                                    style="width: 100%;"
                                    onclick="enableModule()"
                                    th:data-id="${module.id}"
                                    th:data-name="${module.name}">
                                <i class="fas fa-check"></i>启用模块
                            </button>
                            
                            <button type="button" 
                                    class="btn btn-danger" 
                                    style="width: 100%;"
                                    onclick="deleteModule()"
                                    th:data-id="${module.id}"
                                    th:data-name="${module.name}">
                                <i class="fas fa-trash"></i>删除模块
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 统计信息 -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">统计信息</h3>
                    </div>
                    <div class="card-body">
                        <div class="grid grid-cols-1" style="gap: var(--space-4);">
                            <div style="text-align: center; padding: var(--space-4); background-color: var(--color-surface-secondary); border-radius: var(--radius-md);">
                                <div style="font-size: var(--text-2xl); font-weight: var(--font-bold); color: var(--color-text-primary);">-</div>
                                <div style="font-size: var(--text-sm); color: var(--color-text-secondary);">关联工单</div>
                            </div>
                            <div style="text-align: center; padding: var(--space-4); background-color: var(--color-surface-secondary); border-radius: var(--radius-md);">
                                <div style="font-size: var(--text-2xl); font-weight: var(--font-bold); color: var(--color-text-primary);">-</div>
                                <div style="font-size: var(--text-sm); color: var(--color-text-secondary);">待处理</div>
                            </div>
                            <div style="text-align: center; padding: var(--space-4); background-color: var(--color-surface-secondary); border-radius: var(--radius-md);">
                                <div style="font-size: var(--text-2xl); font-weight: var(--font-bold); color: var(--color-text-primary);">-</div>
                                <div style="font-size: var(--text-sm); color: var(--color-text-secondary);">已完成</div>
                            </div>
                        </div>
                        <p style="font-size: var(--text-sm); color: var(--color-text-secondary); text-align: center; margin-top: var(--space-4); margin-bottom: 0;">工单统计功能待实现</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 隐藏表单用于操作 -->
    <form id="actionForm" method="POST" style="display: none;">
        <!-- 用于提交操作的隐藏表单 -->
    </form>
</body>

<th:block layout:fragment="scripts">
    <script>
        function enableModule() {
            const moduleId = [[${module.id}]];
            const moduleName = [[${module.name}]];
            
            if (confirm('确定要启用模块 "' + moduleName + '" 吗？')) {
                const form = document.getElementById('actionForm');
                form.action = '/modules/' + moduleId + '/enable';
                form.submit();
            }
        }
        
        function disableModule() {
            const moduleId = [[${module.id}]];
            const moduleName = [[${module.name}]];
            
            if (confirm('确定要禁用模块 "' + moduleName + '" 吗？')) {
                const form = document.getElementById('actionForm');
                form.action = '/modules/' + moduleId + '/disable';
                form.submit();
            }
        }
        
        function deleteModule() {
            const moduleId = [[${module.id}]];
            const moduleName = [[${module.name}]];
            
            if (confirm('确定要删除模块 "' + moduleName + '" 吗？\n\n注意：删除后不可恢复！')) {
                const form = document.getElementById('actionForm');
                form.action = '/modules/' + moduleId + '/delete';
                form.submit();
            }
        }
    </script>
</th:block>
</html>
