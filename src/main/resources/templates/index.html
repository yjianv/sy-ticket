<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
    <title layout:title-pattern="$CONTENT_TITLE - $LAYOUT_TITLE">仪表盘</title>
</head>
<body>
    <div layout:fragment="content">
        <!-- 页面标题 -->
        <div class="page-header">
            <div class="page-header-content">
                <div class="page-header-left">
                    <h1 class="page-header-title">仪表盘</h1>
                    <p class="page-header-subtitle" th:if="${currentWorkspace != null}">
                        当前工作空间：
                        <span class="workspace-badge" th:style="'background-color: ' + ${currentWorkspace.color}" th:text="${currentWorkspace.name}">工作空间</span>
                    </p>
                </div>
            </div>
        </div>
        
        <!-- 统计卡片 -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4" style="gap: var(--space-6); margin-bottom: var(--space-8);" th:if="${currentWorkspace != null}">
            <!-- 待处理工单 -->
            <div class="stats-card">
                <div class="stats-card-body">
                    <div class="stats-card-content">
                        <div class="stats-card-icon-wrapper" style="background-color: var(--color-primary-500);">
                            <i class="fas fa-clock stats-card-icon"></i>
                        </div>
                        <div class="stats-card-info">
                            <div class="stats-card-label">待处理</div>
                            <div class="stats-card-value">
                                <div class="stats-card-number" th:text="${openCount ?: 0}">0</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="stats-card-footer">
                    <a href="/tickets?status=OPEN" class="stats-card-link" style="color: var(--color-primary-700);">查看详情</a>
                </div>
            </div>
            
            <!-- 处理中工单 -->
            <div class="stats-card">
                <div class="stats-card-body">
                    <div class="stats-card-content">
                        <div class="stats-card-icon-wrapper" style="background-color: var(--color-warning-500);">
                            <i class="fas fa-play stats-card-icon"></i>
                        </div>
                        <div class="stats-card-info">
                            <div class="stats-card-label">处理中</div>
                            <div class="stats-card-value">
                                <div class="stats-card-number" th:text="${inProgressCount ?: 0}">0</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="stats-card-footer">
                    <a href="/tickets?status=IN_PROGRESS" class="stats-card-link" style="color: var(--color-warning-700);">查看详情</a>
                </div>
            </div>
            
            <!-- 已解决工单 -->
            <div class="stats-card">
                <div class="stats-card-body">
                    <div class="stats-card-content">
                        <div class="stats-card-icon-wrapper" style="background-color: var(--color-success-500);">
                            <i class="fas fa-check stats-card-icon"></i>
                        </div>
                        <div class="stats-card-info">
                            <div class="stats-card-label">已解决</div>
                            <div class="stats-card-value">
                                <div class="stats-card-number" th:text="${resolvedCount ?: 0}">0</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="stats-card-footer">
                    <a href="/tickets?status=RESOLVED" class="stats-card-link" style="color: var(--color-success-700);">查看详情</a>
                </div>
            </div>
            
            <!-- 已关闭工单 -->
            <div class="stats-card">
                <div class="stats-card-body">
                    <div class="stats-card-content">
                        <div class="stats-card-icon-wrapper" style="background-color: var(--color-gray-500);">
                            <i class="fas fa-archive stats-card-icon"></i>
                        </div>
                        <div class="stats-card-info">
                            <div class="stats-card-label">已关闭</div>
                            <div class="stats-card-value">
                                <div class="stats-card-number" th:text="${closedCount ?: 0}">0</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="stats-card-footer">
                    <a href="/tickets?status=CLOSED" class="stats-card-link" style="color: var(--color-gray-700);">查看详情</a>
                </div>
            </div>
        </div>

        <!-- 我的工单 -->
        <div class="card" style="margin-bottom: var(--space-8);" th:if="${userTickets != null and !userTickets.isEmpty()}">
            <div class="card-header">
                <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                    <div style="flex: 1;">
                        <h3 class="card-title">我相关的工单</h3>
                        <p style="margin-top: var(--space-1); font-size: var(--text-sm); color: var(--color-text-secondary);">最近的10条工单（包括我创建的和指派给我的）</p>
                    </div>
                    <div style="flex-shrink: 0; margin-left: var(--space-4);">
                        <a href="/tickets" class="btn btn-outline" style="font-size: var(--text-sm); white-space: nowrap;">
                            <i class="fas fa-list" style="margin-right: var(--space-2);"></i>
                            查看全部
                        </a>
                    </div>
                </div>
            </div>
            <div style="overflow: hidden;">
                <table class="table" style="margin-bottom: 0;">
                    <thead>
                    <tr>
                        <th style="width: 40%;">工单</th>
                        <th style="width: 15%;">状态</th>
                        <th style="width: 15%;">优先级</th>
                        <th style="width: 20%;">创建时间</th>
                        <th style="width: 10%;">操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="ticket : ${userTickets}" style="height: 60px;">
                        <td style="vertical-align: middle;">
                            <div>
                                <div style="font-size: var(--text-sm); font-weight: var(--font-medium); color: var(--color-text-primary); margin-bottom: var(--space-1);" th:text="${ticket.ticketNo}">工单编号</div>
                                <div style="font-size: var(--text-xs); color: var(--color-text-secondary); line-height: 1.4;" th:text="${#strings.abbreviate(ticket.title, 45)}">工单标题</div>
                            </div>
                        </td>
                        <td style="vertical-align: middle;">
                                <span class="badge workspace-badge"
                                      th:classappend="'status-' + ${#strings.toLowerCase(ticket.status)}"
                                      th:text="${ticket.status.description}"
                                      style="font-size: var(--text-xs); padding: var(--space-1) var(--space-2);">状态</span>
                        </td>
                        <td style="vertical-align: middle;">
                                <span class="badge workspace-badge"
                                      th:classappend="'priority-' + ${#strings.toLowerCase(ticket.priority)}"
                                      th:text="${ticket.priority.description}"
                                      style="font-size: var(--text-xs); padding: var(--space-1) var(--space-2);">优先级</span>
                        </td>
                        <td style="font-size: var(--text-xs); color: var(--color-text-secondary); vertical-align: middle;">
                            <span th:text="${#temporals.format(ticket.createdAt, 'MM-dd HH:mm')}">创建时间</span>
                        </td>
                        <td style="font-size: var(--text-xs); font-weight: var(--font-medium); vertical-align: middle;">
                            <a th:href="@{/tickets/{id}(id=${ticket.id})}" class="btn-link" style="color: var(--color-primary-600); text-decoration: none;">查看</a>
                        </td>
                    </tr>
                    </tbody>
                </table>

                <div class="card-footer" style="background-color: var(--color-gray-50); border-top: 1px solid var(--color-border-secondary);">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <a href="/tickets" style="font-size: var(--text-sm); color: var(--color-primary-600); text-decoration: none; font-weight: var(--font-medium);">
                            查看所有工单 →
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- 快速操作 -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">快速操作</h3>
            </div>
            <div class="card-body">
                <div class="grid grid-cols-1 md:grid-cols-3" style="gap: var(--space-4);">
                    <a href="/tickets/create" class="quick-action-card" style="background-color: var(--color-primary-50);">
                        <div class="quick-action-icon-wrapper" style="background-color: var(--color-primary-500);">
                            <i class="fas fa-plus quick-action-icon"></i>
                        </div>
                        <div class="quick-action-info">
                            <p class="quick-action-title" style="color: var(--color-primary-900);">创建工单</p>
                            <p class="quick-action-description" style="color: var(--color-primary-700);">新建一个工单</p>
                        </div>
                    </a>
                    
                    <a href="/tickets" class="quick-action-card" style="background-color: var(--color-success-50);">
                        <div class="quick-action-icon-wrapper" style="background-color: var(--color-success-500);">
                            <i class="fas fa-list quick-action-icon"></i>
                        </div>
                        <div class="quick-action-info">
                            <p class="quick-action-title" style="color: var(--color-success-900);">工单列表</p>
                            <p class="quick-action-description" style="color: var(--color-success-700);">查看所有工单</p>
                        </div>
                    </a>
                    
                    <a href="/reports" class="quick-action-card" style="background-color: #f3e8ff;">
                        <div class="quick-action-icon-wrapper" style="background-color: #8b5cf6;">
                            <i class="fas fa-chart-bar quick-action-icon"></i>
                        </div>
                        <div class="quick-action-info">
                            <p class="quick-action-title" style="color: #581c87;">统计报表</p>
                            <p class="quick-action-description" style="color: #7c3aed;">查看数据统计</p>
                        </div>
                    </a>
                </div>
            </div>
        </div>

        <!-- 空状态提示 -->
        <div class="empty-state" th:if="${currentWorkspace == null}">
            <div class="empty-state-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h3 class="empty-state-title">没有可用的工作空间</h3>
            <p class="empty-state-description">请联系管理员创建工作空间。</p>
        </div>
    </div>
</body>
</html>
